schema: '2.0'
stages:
  download_dataset:
    cmd: ( wget https://storage.googleapis.com/mledu-datasets/cats_and_dogs_filtered.zip
      -O cats_and_dogs_filtered.zip && unzip cats_and_dogs_filtered.zip -d ./data/raw
      && rm cats_and_dogs_filtered.zip ) &> logs/download_dataset.out
    outs:
    - path: ./data/raw
      md5: 174fe7fcb400140a007ac05c36b5bfd4.dir
      size: 68556316
      nfiles: 3001
    - path: logs/download_dataset.out
      md5: f211c659367eb1b32f30b385df5260de
      size: 325690
  split_dataset:
    cmd: python scripts/split_dataset.py &> logs/split_dataset.out
    deps:
    - path: ./data/raw
      md5: 174fe7fcb400140a007ac05c36b5bfd4.dir
      size: 68556316
      nfiles: 3001
    - path: scripts/split_dataset.py
      md5: e99a47b198dee35710b7c745b60e928c
      size: 1277
    params:
      params.yaml:
        data.dataset.val_test_split:
          val: 0.7
          test: 0.3
    outs:
    - path: ./data/dataset/dataset.csv
      md5: 2f6641598b7fc6c8d1dd031a6d595161
      size: 68108
    - path: ./data/dataset/test
      md5: 326353ae0eed20bee508f30419a0ec25.dir
      size: 6815914
      nfiles: 305
    - path: ./data/dataset/train
      md5: 0a1a83aa537b94b2b07eb1503701eca7.dir
      size: 45613376
      nfiles: 2000
    - path: ./data/dataset/val
      md5: d34d9a2762c720f7415020cd9ddabb1e.dir
      size: 16126886
      nfiles: 695
    - path: logs/split_dataset.out
      md5: 6fa4014992ad6a7d326be58d4a2563b4
      size: 2224
  train:
    cmd: python scripts/train.py &> logs/train.out
    deps:
    - path: ./data/dataset/train
      md5: 0a1a83aa537b94b2b07eb1503701eca7.dir
      size: 45613376
      nfiles: 2000
    - path: ./data/dataset/val
      md5: d34d9a2762c720f7415020cd9ddabb1e.dir
      size: 16126886
      nfiles: 695
    - path: scripts/train.py
      md5: 9db9df148e8b04efd14d0e19ee79a24e
      size: 3085
    params:
      params.yaml:
        train:
          batch_size: 32
          img_size:
          - 160
          - 160
          learning_rate: 0.0001
          subdir: train
          epochs:
            frozen: 10
            unfrozen: 10
          fine_tune_at: 100
    outs:
    - path: ./data/train/model
      md5: 82882ce07aabe2ac35643926b0b6d8be.dir
      size: 20669958
      nfiles: 3
    - path: ./data/train/training_metrics
      md5: 65babd74171556f7241803f6b6cc10f3.dir
      size: 3039
      nfiles: 4
    - path: logs/train.out
      md5: d043142ef453bf7bc0876f2b7f83dc96
      size: 205489
  evaluate:
    cmd: python scripts/evaluate.py &> logs/evaluate.out
    deps:
    - path: ./data/dataset/test
      md5: 326353ae0eed20bee508f30419a0ec25.dir
      size: 6815914
      nfiles: 305
    - path: ./data/train/model
      md5: 82882ce07aabe2ac35643926b0b6d8be.dir
      size: 20669958
      nfiles: 3
    - path: scripts/evaluate.py
      md5: aada14c8861cb28746abb5aa78e9c4c3
      size: 1377
    outs:
    - path: ./data/evaluation/metrics.json
      md5: 5ba98eca1d691aa800be75ffd1aa7ea0
      size: 55
    - path: ./data/evaluation/predictions.csv
      md5: bc719f5920d5ae7f1b188f85ea757b96
      size: 21632
    - path: logs/evaluate.out
      md5: 65a3dcf9a5d56faa40bd4b6c0eba3c7c
      size: 712
